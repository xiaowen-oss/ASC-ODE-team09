# Exercise 3 (Due 08.12.2025)

*All documents we mentioned can be found in branch "Exercise3".

## Exercise 20.4

### Q1: Test the examples

1. Update the upsteam and get folder `mechsystem`
2. Modify Cmakelist:

 ① First, add cmake version, project name and standard

```
cmake_minimum_required(VERSION 3.20)
project(mechsystem)
set (CMAKE_CXX_STANDARD 20)
```
 ② Then, include the head file in the root 'src'

```
include_directories(${CMAKE_CURRENT_SOURCE_DIR})

add_executable (test_mass_spring mass_spring.cpp ${CMAKE_SOURCE_DIR}/src)
```
③ In the end, use pybind to create python module
```
pybind11_add_module(mass_spring
    bind_mass_spring.cpp
)

target_include_directories(mass_spring PRIVATE 
    ${CMAKE_CURRENT_SOURCE_DIR}
)
```

3. Build and compile in `.venv` enviroment. (Since we install python in .venv enviroment in case of extra conflicts)

```
# activate the enviroment
source .venv/bin/activate

# build file
mkdir build
cd build

# use venv Python to open CMake
cmake -DPython_EXECUTABLE=$(which python) ..

# Compile 
cmake ..
make -j
```

4. We can test the exmaple files:

```
./test_mass_spring > test.txt
```
[Test1: The result link](data_ex3/test.txt)

```
cd ~/ASC-ODE-team09/mechsystem

PYTHONPATH=../build/mechsystem python3 test_mass_spring.py >test2.txt
```

[Test2 : The result link](data_ex3/test2.txt)


5. We can also test the 3D version according to `mass_spring.ipynb`

① Install pythreejs and activate

```
pip install pythreejs

jupyter nbextension enable --py widgetsnbextension
jupyter nbextension enable --py pythreejs
```

② Here we run directly in vscode. Pay attention: change the local repo
```
sys.path.append('../build/mechsystem')
```
![test 3D version](data_ex3/test1.mp4)



### Q2: Add Lagragian constraints
回顾问题
改了massspring.hpp和bind
可以用那个cpp打印约束参数，然后分析


一开始加一个除法运算
// operator a/b
template <size_t D>
Vec<D> operator/(const Vec<D> &v, double s)
{
    Vec<D> r;
    for (size_t i = 0; i < D; i++)
        r(i) = v(i) / s;
    return r;
}



class DistanceConstraint
{
public:
    Connector c1;
    Connector c2;
    double rest_length;
};


std::vector<DistanceConstraint> m_constraints;  


public:auto & constraints() { return m_constraints;}

  void addDistanceConstraint(const DistanceConstraint &dc)
  {
    m_constraints.push_back(dc);
  }



![test2 3D version](data_ex3/test2.mp4)










